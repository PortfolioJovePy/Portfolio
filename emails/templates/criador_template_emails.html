<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Elementos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        button, input {
            margin: 5px;
            padding: 10px;
        }
        .draggable {
            position: absolute;
            cursor: grab;
        }
        .frame {
            width: 80vw;
            height: 80vh;
            border: 2px dashed #ccc;
            position: relative;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
            background-color: white;
            resize: both;
            overflow: auto;
        }
        .resize-handle {
            width: 15px;
            height: 15px;
            background-color: gray;
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: se-resize;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="text" id="templateName" class="form-control" placeholder="Nome do template">
        <input type="text" id="backgroundColor" class="form-control" placeholder="Cor de fundo (RGB)">
        <input type="text" id="titleColor" class="form-control" placeholder="Cor dos títulos (RGB)">
        <input type="text" id="subtitleColor" class="form-control" placeholder="Cor dos subtítulos (RGB)">
        <input type="text" id="paragraphColor" class="form-control" placeholder="Cor dos parágrafos (RGB)">        
        <button class="btn btn-secondary" onclick="addElement('h1')">Adicionar Título</button>
        <button class="btn btn-secondary" onclick="addElement('h2')">Adicionar Subtitulo</button>
        <button class="btn btn-secondary" onclick="addElement('p')">Adicionar Parágrafo</button>
        <button class="btn btn-secondary" onclick="addElement('a')">Adicionar Link</button>
        <button class="btn btn-secondary" onclick="addElement('img')">Adicionar Imagem</button>
        <button class="btn btn-danger" onclick="saveSettings()">Salvar</button>
        <button class="btn btn-warning" onclick="clearAllElements()">Limpar Todos</button>
        <button class="btn btn-info" onclick="downloadFrameContent()">Baixar Conteúdo</button>
    </div>
    
    <div id="frame" class="frame"></div>

    <script>
        let elementIdCounter = 0;

        function saveSettings() {
    const templateName = document.getElementById("templateName").value;
    const backgroundColor = document.getElementById("backgroundColor").value;
    const titleColor = document.getElementById("titleColor").value;
    const subtitleColor = document.getElementById("subtitleColor").value;  // Adicionando cor do subtítulo
    const paragraphColor = document.getElementById("paragraphColor").value;

    localStorage.setItem("templateName", templateName);
    localStorage.setItem("backgroundColor", backgroundColor);
    localStorage.setItem("titleColor", titleColor);
    localStorage.setItem("subtitleColor", subtitleColor);  // Salvando cor do subtítulo
    localStorage.setItem("paragraphColor", paragraphColor);

    saveAndReload();    
}


function applySettings() {
    const savedTemplateName = localStorage.getItem("templateName") || "";
    const savedBackgroundColor = localStorage.getItem("backgroundColor") || "white";
    const savedTitleColor = localStorage.getItem("titleColor") || "black";
    const savedSubtitleColor = localStorage.getItem("subtitleColor") || "black"; // Alterado para subtitleColor
    const savedParagraphColor = localStorage.getItem("paragraphColor") || "black";

    document.getElementById("templateName").value = savedTemplateName;
    document.getElementById("backgroundColor").value = savedBackgroundColor;
    document.getElementById("titleColor").value = savedTitleColor;
    document.getElementById("subtitleColor").value = savedSubtitleColor;  // Corrigido para refletir a cor do subtítulo
    document.getElementById("paragraphColor").value = savedParagraphColor;
    document.getElementById("frame").style.backgroundColor = savedBackgroundColor;
}

        function addElement(type) {
    const frame = document.getElementById("frame");
    const element = document.createElement(type);

    const elementId = `${type}_${elementIdCounter++}`;
    let elementData = {
        id: elementId,
        type: type,
        content: '',
        href: '',
        left: '50px',
        top: '50px',
        borderRadius: '0'  // Adicionando a propriedade de borda arredondada
    };

    if (type === 'h1') {
        element.textContent = "Título Exemplo";
        elementData.content = "Título Exemplo";
        element.classList.add("fs-1");
        element.classList.add("fw-bolder");
        element.style.color = localStorage.getItem("titleColor") || "black";
        element.setAttribute("contenteditable", "true");
    } else if (type === 'h2') {
        element.textContent = "Subtítulo Exemplo";  // Corrigido para exibir o subtítulo corretamente
        elementData.content = "Subtítulo Exemplo"; // Corrigido para refletir o conteúdo do subtítulo
        element.classList.add("fs-3");  // Classe para subtítulo
        element.style.color = localStorage.getItem("subtitleColor") || "black";  // Cor do subtítulo
        element.setAttribute("contenteditable", "true");
    } else if (type === 'p') {
        element.textContent = "Este é um parágrafo de exemplo.";
        elementData.content = "Este é um parágrafo de exemplo.";
        element.classList.add("fs-5");
        element.style.color = localStorage.getItem("paragraphColor") || "black";
        element.setAttribute("contenteditable", "true");
    } else if (type === 'a') {
        let userText = prompt("Digite o texto do link:");
        let userHref = prompt("Digite a URL do link:", "https://");

        if (!userText || !userHref) return;

        element.textContent = userText;
        element.href = userHref;
        element.target = "_blank";
        elementData.content = userText;
        elementData.href = userHref;
    } else if (type === 'img') {
        let userSrc = prompt("Digite a URL da imagem:");
        if (!userSrc) return;

        element.src = userSrc;
        element.alt = "Imagem adicionada";
        element.style.width = "150px";
        elementData.content = userSrc;
    }

    element.classList.add("draggable");
    element.style.left = elementData.left;
    element.style.top = elementData.top;
    element.id = elementId;
    element.style.borderRadius = elementData.borderRadius; // Aplicando o border-radius
    frame.appendChild(element);
    makeDraggable(element, elementData, frame);

    // Adicionando ouvinte para salvar o conteúdo ao ser alterado
    element.addEventListener("input", () => {
        elementData.content = element.textContent;  // Atualiza o conteúdo do elemento
        saveElementToSessionStorage(elementData);
    });

    saveElementToSessionStorage(elementData);
}


function saveElementToSessionStorage(elementData) {
    let elements = JSON.parse(sessionStorage.getItem("elements")) || [];
    elements = elements.filter(e => e.id !== elementData.id);
    elements.push(elementData);
    sessionStorage.setItem("elements", JSON.stringify(elements));
}


function loadElementsFromSessionStorage() {
    const elements = JSON.parse(sessionStorage.getItem("elements")) || [];
    elements.forEach(data => {
        const element = document.createElement(data.type);

        if (data.type === 'h1') {
            element.textContent = data.content;
            element.classList.add("fs-1");
            element.classList.add("fw-bolder");
            element.style.color = localStorage.getItem("titleColor") || "black";
        } else if (data.type === 'h2') {
            element.textContent = data.content;
            element.classList.add("fs-3");  // Agora a classe fs-3 para o subtítulo
            element.style.color = localStorage.getItem("subtitleColor") || "black";
        } else if (data.type === 'p') {
            element.textContent = data.content;
            element.classList.add("fs-5");
            element.style.color = localStorage.getItem("paragraphColor") || "black";
        } else if (data.type === 'a') {
            element.textContent = data.content;
            element.href = data.href;
            element.target = "_blank";
        } else if (data.type === 'img') {
            element.src = data.content;
            element.alt = "Imagem adicionada";
            element.style.width = "150px";
            element.style.borderRadius = data.borderRadius;  // Carregando a borda da imagem
        }

        element.classList.add("draggable");
        element.style.left = data.left;
        element.style.top = data.top;
        element.id = data.id;
        document.getElementById("frame").appendChild(element);
        makeDraggable(element, data, document.getElementById("frame"));
    });
}


        window.onload = function () {
            applySettings();
            loadElementsFromSessionStorage();
        };

        function makeDraggable(element, elementData, frame) {
            let offsetX, offsetY, isDragging = false;

            element.addEventListener("mousedown", (e) => {
                isDragging = true;
                offsetX = e.clientX - element.getBoundingClientRect().left;
                offsetY = e.clientY - element.getBoundingClientRect().top;
                element.style.cursor = "grabbing";
            });

            document.addEventListener("mousemove", (e) => {
                if (!isDragging) return;

                let newLeft = e.clientX - offsetX - frame.getBoundingClientRect().left;
                let newTop = e.clientY - offsetY - frame.getBoundingClientRect().top;

                newLeft = Math.max(0, Math.min(frame.offsetWidth - element.offsetWidth, newLeft));
                newTop = Math.max(0, Math.min(frame.offsetHeight - element.offsetHeight, newTop));

                element.style.left = `${newLeft}px`;
                element.style.top = `${newTop}px`;
            });

            document.addEventListener("mouseup", () => {
                if (!isDragging) return;
                isDragging = false;
                element.style.cursor = "grab";
                elementData.left = element.style.left;
                elementData.top = element.style.top;
                saveElementToSessionStorage(elementData);
            });
        }

        // Função para alternar o border-radius da imagem
        function toggleBorderRadius(element, elementData) {
            // Ciclo: quadrado -> cantos arredondados -> redondo
            if (element.style.borderRadius === "50%") {
                element.style.borderRadius = "10%";  // Borda com cantos arredondados
                elementData.borderRadius = "10%";
            } else if (element.style.borderRadius === "10%") {
                element.style.borderRadius = "0";  // Volta para o quadrado
                elementData.borderRadius = "0";
            } else {
                element.style.borderRadius = "50%";  // Torna a borda redonda
                elementData.borderRadius = "50%";
            }

            saveElementToSessionStorage(elementData);
        }

        // Detecta o clique na imagem
        document.addEventListener("click", (e) => {
            if (e.target.tagName.toLowerCase() === 'img') {
                const element = e.target;
                const elementData = JSON.parse(sessionStorage.getItem("elements")).find(el => el.id === element.id);
                toggleBorderRadius(element, elementData);
            }
        });

        function saveAndReload() {
            location.reload();
        }

        function clearAllElements() {
            sessionStorage.removeItem("elements");
            location.reload();
        }

        function downloadFrameContent() {
            const frameContent = document.getElementById('frame').innerHTML;
            const templateName = localStorage.getItem("templateName") || "template";

            const htmlContent = `
    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
                margin: 20px;
                background-color: ${localStorage.getItem("backgroundColor") || "white"};
            }
            .draggable {
                position: absolute;
                cursor: grab;
            }
            .frame {
                width: 80vw;
                height: 80vh;
                border: 2px dashed #ccc;
                position: relative;
                margin-top: 20px;
                margin-left: auto;
                margin-right: auto;
                background-color: white;
            }
        </style>
    </head>
    <body>
                ${frameContent}
    </body>
    </html>
            `;
    
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${templateName}.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
    </script>
</body>
</html>
